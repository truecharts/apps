image:
  repository: kubernetesui/dashboard-web
  pullPolicy: IfNotPresent
  tag: 1.4.0

authImage:
  repository: docker.io/kubernetesui/dashboard-auth
  pullPolicy: IfNotPresent
  tag: 1.1.3

apiImage:
  repository: kubernetesui/dashboard-api
  pullPolicy: IfNotPresent
  tag: 1.7.0

scraperImage:
  repository: kubernetesui/dashboard-metrics-scraper
  pullPolicy: IfNotPresent
  tag: 1.1.1.1

service:
  main:
    enabled: true
    ports:
      main:
        enabled: true
        primary: true
        port: 80
        targetPort: 8000
        protocol: http
  kubernetes-dashboard-web:
    expandObjectName: false
    enabled: true
    ports:
      main:
        enabled: true
        primary: true
        port: 8000
        targetPort: 8000
        protocol: http
  kubernetes-dashboard-api:
    expandObjectName: false
    enabled: true
    ports:
      main:
        enabled: true
        port: 8000
        targetPort: 8000
        protocol: http
  kubernetes-dashboard-auth:
    expandObjectName: false
    enabled: true
    ports:
      main:
        enabled: true
        port: 8000
        targetPort: 8000
        protocol: http
  kubernetes-dashboard-scraper:
    expandObjectName: false
    enabled: true
    ports:
      main:
        enabled: true
        port: 8000
        targetPort: 8000
        protocol: http

workload:
  main:
    enabled: true
    podSpec:
      containers:
        main:
          enabled: true
          args:
            - --namespace={{ .Release.Namespace }}
            - --metrics-scraper-service-name=todo
            # GOMAXPROCS:
            #     resourceFieldRef:
            #       resource: limits.cpu
            #GOMEMLIMIT:
            #  valueFrom:
            #    resourceFieldRef:
            #      resource: limits.memory
        api:
          enabled: true
          imageSelector: apiImage
          args:
            - --namespace={{ .Release.Namespace }}
            - --metrics-scraper-service-name=todo
          env:
            CSRF_KEY:
              secretKeyRef:
                name: csrf
                key: private.key

            # GOMAXPROCS:
            #     resourceFieldRef:
            #       resource: limits.cpu
            #GOMEMLIMIT:
            #  valueFrom:
            #    resourceFieldRef:
            #      resource: limits.memory

          probes:
            liveness:
              enabled: true
              type: http
              port: 8000
            readiness:
              enabled: true
              type: http
              port: 8000
            startup:
              enabled: true
              type: http
              port: 8000

        auth:
          enabled: true
          imageSelector: authImage
          env:
            CSRF_KEY:
              secretKeyRef:
                name: csrf
                key: private.key

            # GOMAXPROCS:
            #     resourceFieldRef:
            #       resource: limits.cpu
            #GOMEMLIMIT:
            #  valueFrom:
            #    resourceFieldRef:
            #      resource: limits.memory

          probes:
            liveness:
              enabled: true
              type: http
              port: 8000
            readiness:
              enabled: true
              type: http
              port: 8000
            startup:
              enabled: true
              type: http
              port: 8000

        scraper:
          enabled: true
          imageSelector: scraperImage
          env:
            CSRF_KEY:
              secretKeyRef:
                name: csrf
                key: private.key

            # GOMAXPROCS:
            #     resourceFieldRef:
            #       resource: limits.cpu
            #GOMEMLIMIT:
            #  valueFrom:
            #    resourceFieldRef:
            #      resource: limits.memory
          probes:
            liveness:
              enabled: true
              type: http
              port: 8000
            readiness:
              enabled: true
              type: http
              port: 8000
            startup:
              enabled: true
              type: http
              port: 8000

podOptions:
  automountServiceAccountToken: true

configmap:
  settings:
    enabled: true
    data:
      settings: '{"itemsPerPage":100}'
  kubedashboard-konggateway:
    enabled: true
    expandObjectName: false
    data:
      kong.yml: |
        _format_version: "3.0"
        services:
          - name: auth
            host: kubernetes-dashboard-auth
            port: 8000
            protocol: http
            routes:
              - name: authLogin
                paths:
                  - /api/v1/login
                strip_path: false
              - name: authCsrf
                paths:
                  - /api/v1/csrftoken/login
                strip_path: false
              - name: authMe
                paths:
                  - /api/v1/me
                strip_path: false
          - name: api
            host: kubernetes-dashboard-api
            port: 8000
            protocol: http
            routes:
              - name: api
                paths:
                  - /api
                strip_path: false
              - name: metrics
                paths:
                  - /metrics
                strip_path: false
          - name: web
            host: kubernetes-dashboard-web
            port: 8000
            protocol: http
            routes:
              - name: root
                paths:
                  - /
                strip_path: false


secret:
  csrf:
    enabled: true
    data: 
      private.key: ZHdwY1JlYTlCWkVhWVEydmEvdXA2dUwzOUdERkFZN2JCcFU0a25UM3dnZVVOazlHUGFpWmptaXNhS3VMdUVvS2o1VENJUTdnKzlpZzA3S3BZYzM0MVpiVjNBSlBsMzZZSFN5eC9Rdi9uMnlaVDlYZ3BOb0IyRk02ZjBnczhEcXVxU0V1aWd4aC9rSEpSRVVpSFFtUUNrMDlTSG10ZFkzRnBpb1UzMGdlNjlNQ1JtdERmdmRoOVhteXRBYjR1M3VxeElmQWQ5QmRKcEdoZzZtMGVJQU15QnRNdHZaMnl6eVRhWjJPdXVLZnNwdVFaZThhYjJCcCtQSGxLOFNrcTY0RS9STzJVdzRjblFHTXFjQXhhdEszZEVPMmhtR1hOMm1uWVhxQXN3S0hIeWJBV2xCVW1UT3JDSFJuY1M3N3kyZjQwSk9PbWRoa0ZSREZJcWdOVC95aTd3PT0=

portal:
  open:
    enabled: true

rbac:
  main:
    enabled: true
    primary: true
    clusterWide: true
    rules:
      - apiGroups: [""]
        resources: ["secrets"]
        resourceNames: ["kubernetes-dashboard-key-holder", "kubernetes-dashboard-certs", "kubernetes-dashboard-csrf"]
        verbs: ["get", "update", "delete"]
        # Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.
      - apiGroups: [""]
        resources: ["configmaps"]
        resourceNames: ["kubernetes-dashboard-settings"]
        verbs: ["get", "update"]
        # Allow Dashboard to get metrics.
      - apiGroups: [""]
        resources: ["services"]
        resourceNames: ["heapster", "dashboard-metrics-scraper"]
        verbs: ["proxy"]
      - apiGroups: [""]
        resources: ["services/proxy"]
        resourceNames: ["heapster", "http:heapster:", "https:heapster:", "dashboard-metrics-scraper", "http:dashboard-metrics-scraper"]
        verbs: ["get"]
      - apiGroups: ["metrics.k8s.io"]
        resources: ["pods", "nodes"]
        verbs: ["get", "list", "watch"]
      # Give all-access
      - apiGroups: ["*"]
        resources: ["*"]
        verbs: ["*"]

# -- The service account the pods will use to interact with the Kubernetes API
serviceAccount:
  main:
    enabled: true
    primary: true
    targetSelectAll: true

## Required Kong sub-chart with DBless configuration to act as a gateway
## for our all containers.
kong:
  enabled: true
  ## Configuration reference: https://docs.konghq.com/gateway/3.6.x/reference/configuration
  env:
    dns_order: LAST,A,CNAME,AAAA,SRV
    plugins: 'off'
    nginx_worker_processes: 1
  ingressController:
    enabled: false
  dblessConfig:
    configMap: kubedashboard-konggateway
  proxy:
    type: ClusterIP
    http:
      enabled: false