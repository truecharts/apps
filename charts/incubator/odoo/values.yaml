image:
  repository: tccr.io/truecharts/odoo
  pullPolicy: IfNotPresent
  tag: v16.0.0@sha256:9a0e0d913dc6c4ed5904ae233dc2de7fa1a00f10eb5a66f21e1f695c62933a1d

service:
  main:
    ports:
      main:
        port: 8069

odoo:
  additionalConf: []

workload:
  main:
    podSpec:
      initContainers:
        init-db:
          type: install
          enabled: true
          imageSelector: "image"
          command:
            - /usr/bin/odoo
            - -c
          args:
            - --config=/etc/odoo/odoo.conf
            - --stop-after-init
            - --without-demo=all
            - --init=base
      containers:
        main:
          probes:
            liveness:
              enabled: true
              type: http
              path: /web/health
            readiness:
              enabled: true
              type: http
              path: /web/health
            startup:
              enabled: true
              type: http
              path: /web/health
          env:
            USER: "{{ .Values.cnpg.main.user }}"
            PORT: 5432
            PASSWORD:
              secretKeyRef:
                name: cnpg-main-user
                key: password
            HOST:
              secretKeyRef:
                name: cnpg-main-urls
                key: host

persistence:
  odoo:
    enabled: true
    mountPath: "/var/lib/odoo"
    targetSelectAll: true
  addons:
    enabled: true
    mountPath: "/mnt/extra-addons"
    targetSelectAll: true
  odoo-config:
    enabled: true
    type: configmap
    objectName: odoo-config
    mountPath: /etc/odoo/odoo.conf
    subPath: odoo.conf
    targetSelectAll: true
    readOnly: true

# Enabled postgres
cnpg:
  main:
    enabled: true
    user: odoo
    database: postgres

portal:
  open:
    enabled: true
