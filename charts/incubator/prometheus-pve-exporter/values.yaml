image:
  repository: docker.io/prompve/prometheus-pve-exporter
  tag: 3.4.7@sha256:d44f72468a35d8ba3395b72c781a0822d4bc76912e8bc0a0f69a3e8d96f55e72

service:
  main:
    ports:
      main:
        protocol: http
        port: 9221

pve:
  credentials:
    # The username in the format 'username@realm' for authentication.
    user: username@realm
    # The name of the API token to be used for authentication.
    tokenName: your-token-name
    # The value of the API token to be used for authentication.
    # The token role should be set to PVEAuditor on Proxmox VE.
    tokenValue: your-token-value
  general:
    # The Proxmox VE instance to scrape metrics from, specified by IP or hostname.
    target: pve.example.com
    # Toggle TLS certificate verification for Proxmox VE.
    verifySsl: true

workload:
  main:
    podSpec:
      containers:
        main:
          env:
            PVE_VERIFY_SSL: "{{ .Values.pve.general.verifySsl }}"
            PVE_USER:
              secretKeyRef:
                name: secrets
                key: PVE_USER
            PVE_TOKEN_NAME:
              secretKeyRef:
                name: secrets
                key: PVE_TOKEN_NAME
            PVE_TOKEN_VALUE:
              secretKeyRef:
                name: secrets
                key: PVE_TOKEN_VALUE
          args:
            - --web.listen-address
            - :{{ .Values.service.main.ports.main.port }}
            # Optional arguments to disable specific collectors in the exporter. By default, all collectors are enabled.
            # - "--no-collector.status"
            # - "--no-collector.version"
            # - "--no-collector.node"
            # - "--no-collector.cluster"
            # - "--no-collector.resources"
            # - "--no-collector.config"

metrics:
  main:
    enabled: true
    type: servicemonitor
    endpoints:
      - port: main
        path: "/pve"
        params:
          target:
            - "{{ .Values.pve.general.target }}"
        relabelings:
          - targetLabel: instance
            replacement: "{{ .Values.pve.general.target }}"

portal:
  open:
    enabled: false
