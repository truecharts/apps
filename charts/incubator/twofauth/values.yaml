image:
  repository: tccr.io/truecharts/2fauth
  pullPolicy: IfNotPresent
  tag: v4.2.2@sha256:0383cb30609aa4cb60fd00b7a15c7f8e18533c18714144d498fcc2ea0744297f

securityContext:
  container:
    runAsNonRoot: false
    readOnlyRootFilesystem: false
    runAsUser: 0
    runAsGroup: 0

service:
  main:
    ports:
      main:
        protocol: http
        targetPort: 8000
        port: 8000

twofauth:
  app:
    name: "2FAuth"
    debug: false
    site_owner: "mail@example.com"
    url: "http://localhost"
    # daily | single
    log_channel: "daily"
    # debug | info | notice | warning | error | critical | alert | emergency
    log_level: "notice"
    trusted_proxies:
      - "*"
  mail:
    driver: smtp
    host: smtp.mailtrap.io
    port: 587
    from: changeme@example.com
    user: changeme@example.com
    pass: changeme
    # TLS | STARTTLS | SSL
    encryption: STARTTLS
    from_name: 2FAuth
    from_address: changeme@example.com
  auth:
    # web-guard | reverse-proxy-guard
    guard: web-guard
    # show if guard uses reverse-proxy-guard
    proxy_header_for_user: ""
    proxy_header_for_email: ""
    proxy_logout_url: ""
  webauthn:
    name: 2FAuth
    id: ""
    icon: ""
    # required | preferred | discouraged
    user_verified: preferred

workload:
  main:
    podSpec:
      containers:
        main:
          env:
            APP_KEY:
              secretKeyRef:
                name: twofauth-secrets
                key: APP_KEY
            APP_ENV: local
            # If you're looking for performance improvements, you could install memcached.
            CACHE_DRIVER: file
            SESSION_DRIVER: file
            # redis
            REDIS_HOST:
              secretKeyRef:
                expandObjectName: false
                name: '{{ printf "%s-%s" .Release.Name "rediscreds" }}'
                key: plainhost
            REDIS_PASSWORD:
              secretKeyRef:
                expandObjectName: false
                name: '{{ printf "%s-%s" .Release.Name "rediscreds" }}'
                key: redis-password
            REDIS_PORT: 6379
            REDIS_USERNAME: "{{ .Values.redis.redisUsername }}"
            BROADCAST_DRIVER: log
            QUEUE_DRIVER: sync
            SESSION_LIFETIME: 120
            # mysql
            DB_CONNECTION: mysql
            DB_HOST:
              secretKeyRef:
                name: '{{ printf "%s-%s" .Release.Name "mariadbcreds" }}'
                key: plainhost
            DB_PORT: 3306
            DB_DATABASE: "{{ .Values.mariadb.mariadbDatabase }}"
            DB_USERNAME: "{{ .Values.mariadb.mariadbUsername }}"
            DB_PASSWORD:
              secretKeyRef:
                name: '{{ printf "%s-%s" .Release.Name "mariadbcreds" }}'
                key: mariadb-password
            # config
            # IS_DEMO_APP: false
            # APP
            APP_NAME: "{{ .Values.twofauth.app.name }}"
            APP_DEBUG: "{{ .Values.twofauth.app.debug }}"
            SITE_OWNER: "{{ .Values.twofauth.app.site_owner }}"
            APP_URL: "{{ .Values.twofauth.app.url }}"
            LOG_CHANNEL: "{{ .Values.twofauth.app.log_channel }}"
            LOG_LEVEL: "{{ .Values.twofauth.app.log_level }}"
            trusted_proxies: '{{ join "," .Values.twofauth.app.trusted_proxies }}'
            # MAIL
            MAIL_DRIVER: "{{ .Values.twofauth.mail.driver }}"
            MAIL_HOST: "{{ .Values.twofauth.mail.host }}"
            MAIL_PORT: "{{ .Values.twofauth.mail.port }}"
            MAIL_FROM: "{{ .Values.twofauth.mail.from }}"
            MAIL_USERNAME: "{{ .Values.twofauth.mail.user }}"
            MAIL_PASSWORD: "{{ .Values.twofauth.mail.pass }}"
            MAIL_ENCRYPTION: "{{ .Values.twofauth.mail.encryption }}"
            MAIL_FROM_NAME: "{{ .Values.twofauth.mail.from_name }}"
            MAIL_FROM_ADDRESS: "{{ .Values.twofauth.mail.from_address }}"
            # AUTH
            AUTHENTICATION_GUARD: "{{ .Values.twofauth.auth.guard }}"
            AUTH_PROXY_HEADER_FOR_USER: "{{ .Values.twofauth.auth.proxy_header_for_user }}"
            AUTH_PROXY_HEADER_FOR_EMAIL: "{{ .Values.twofauth.auth.proxy_header_for_email }}"
            PROXY_LOGOUT_URL: "{{ .Values.twofauth.auth.proxy_logout_url }}"
            # WebAuthn:
            WEBAUTHN_NAME: "{{ .Values.twofauth.webauthn.name }}"
            WEBAUTHN_ID: "{{ .Values.twofauth.webauthn.id }}"
            # Optional image data in BASE64 (128 bytes maximum) or an image url
            WEBAUTHN_ICON: "{{ .Values.twofauth.webauthn.icon }}"
            WEBAUTHN_USER_VERIFICATION: "{{ .Values.twofauth.webauthn.user_verified }}"

persistence:
  config:
    enabled: true
    mountPath: "/2fauth"

mariadb:
  enabled: true
  user: twofauth
  database: twofauth
redis:
  enabled: true
  redisUsername: twofauth

portal:
  open:
    enabled: true
